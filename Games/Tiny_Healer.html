<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tiny Healer - Raid Healer Simulator</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600&family=Raleway:wght@300;400;600&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #f0c050;
            --secondary-color: #8a2be2;
            --success-color: #32cd32;
            --danger-color: #ff4500;
            --dark-bg: #121212;
            --darker-bg: #0a0a0a;
            --light-bg: #1e1e1e;
            --text-color: #e0e0e0;
            --border-color: #333;
            --shadow-color: rgba(0, 0, 0, 0.7);
            --class-tank: #C79C6E;
            --class-rogue: #FFF569;
            --class-mage: #40C7EB;
            --class-healer: #F58CBA;
            --class-warlock: #9482C9;
            --mana-color: #0070DE;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-user-select: none;
            user-select: none;
        }

        body {
            font-family: 'Raleway', sans-serif;
            background: linear-gradient(135deg, #1a1a2e, #16213e, #0f3460);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* Welcome Screen */
        #welcome-screen {
            width: 900px;
            height: 600px;
            background: linear-gradient(145deg, rgba(30, 30, 40, 0.95), rgba(20, 20, 30, 0.95));
            border-radius: 8px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            position: relative;
            border: 1px solid #444;
        }

        #welcome-screen h1 {
            font-family: 'Cinzel', serif;
            font-size: 64px;
            color: var(--primary-color);
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(240, 192, 80, 0.3);
        }

        .tagline {
            color: #aaa;
            margin-bottom: 30px;
            font-size: 18px;
        }

        #start-button {
            font-family: 'Cinzel', serif;
            font-size: 24px;
            padding: 15px 50px;
            background: #800000;
            color: #fff;
            border: 2px solid #a00000;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }

        #start-button:hover {
            background: #a00000;
            transform: translateY(-2px);
        }

        /* Game Container */
        #game-container {
            width: 1000px;
            height: 700px;
            background: #111;
            border-radius: 4px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            padding: 20px;
            display: none;
            grid-template-rows: 1fr auto;
            gap: 20px;
            border: 1px solid #333;
        }

        /* Combat Area */
        #combat-area {
            display: grid;
            grid-template-columns: 1fr 300px;
            gap: 20px;
            height: 100%;
        }

        /* Raid Frames */
        #raid-frames {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-auto-rows: 80px;
            gap: 10px;
            align-content: start;
        }

        .unit-frame {
            background: #222;
            border: 1px solid #444;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            transition: border-color 0.1s;
            overflow: hidden;
        }

        .unit-frame:hover {
            border-color: #666;
        }

        .unit-frame.selected {
            border-color: #fff;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
        }

        .unit-frame.dead {
            filter: grayscale(100%);
            opacity: 0.6;
        }

        .health-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            background: #333;
            transition: width 0.2s ease-out;
            z-index: 1;
        }

        .unit-info {
            position: relative;
            z-index: 2;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            padding: 0 10px;
            text-shadow: 1px 1px 2px #000;
            font-weight: 600;
            color: #fff;
        }

        .unit-name {
            font-size: 16px;
        }

        .unit-hp {
            font-size: 14px;
        }

        .unit-frame[data-role="tank"] .health-fill {
            background-color: var(--class-tank);
        }

        .unit-frame[data-role="rogue"] .health-fill {
            background-color: var(--class-rogue);
        }

        .unit-frame[data-role="mage"] .health-fill {
            background-color: var(--class-mage);
        }

        .unit-frame[data-role="healer"] .health-fill {
            background-color: var(--class-healer);
        }

        .unit-frame[data-role="warlock"] .health-fill {
            background-color: var(--class-warlock);
        }

        /* Buffs/Debuffs on Frame */
        .auras {
            position: absolute;
            bottom: 4px;
            left: 4px;
            display: flex;
            gap: 2px;
            z-index: 3;
        }

        .aura {
            width: 20px;
            height: 20px;
            border-radius: 2px;
            background-size: cover;
            border: 1px solid #000;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 12px;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
        }

        .aura.hot {
            border-color: var(--success-color);
            background-color: rgba(50, 205, 50, 0.5);
        }

        .aura.dot {
            border-color: var(--danger-color);
            background-color: rgba(255, 69, 0, 0.5);
        }

        /* Boss Frame */
        #boss-frame {
            background: #1a1a1a;
            border: 2px solid #555;
            padding: 15px;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            height: fit-content;
        }

        #boss-name {
            color: var(--danger-color);
            font-family: 'Cinzel', serif;
            font-size: 20px;
            text-align: center;
        }

        #boss-hp-bar {
            height: 25px;
            background: #333;
            border: 1px solid #000;
            position: relative;
        }

        #boss-hp-fill {
            height: 100%;
            background: #b71c1c;
            width: 100%;
            transition: width 0.2s;
        }

        #boss-hp-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 23px;
            color: #fff;
            font-size: 12px;
            text-shadow: 1px 1px 1px #000;
        }

        /* Player Controls */
        #player-controls {
            display: flex;
            flex-direction: column;
            gap: 15px;
            background: #1a1a1a;
            padding: 15px;
            border-top: 1px solid #333;
            border-radius: 4px;
        }

        /* Cast Bar */
        #cast-bar-container {
            width: 400px;
            height: 25px;
            background: #222;
            border: 1px solid #444;
            margin: 0 auto;
            position: relative;
            opacity: 0;
            /* Hidden when not casting */
            transition: opacity 0.1s;
        }

        #cast-bar-container.casting {
            opacity: 1;
        }

        #cast-bar-fill {
            height: 100%;
            background: #f0c050;
            width: 0%;
        }

        #cast-bar-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 23px;
            color: #fff;
            font-weight: bold;
            font-size: 12px;
            top: 0;
            text-shadow: 1px 1px 0 #000;
        }

        /* Action Bar */
        #action-bar {
            display: flex;
            justify-content: center;
            gap: 10px;
        }

        .spell-btn {
            width: 60px;
            height: 60px;
            background: #333;
            border: 1px solid #555;
            border-radius: 4px;
            position: relative;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 24px;
            color: #aaa;
            transition: all 0.1s;
        }

        .spell-btn:hover {
            border-color: #888;
            color: #fff;
        }

        .spell-btn.active {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(240, 192, 80, 0.3);
        }

        .spell-btn.cooldown {
            filter: grayscale(100%);
            cursor: default;
        }

        .spell-cd-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 18px;
            color: #fff;
            font-weight: bold;
            display: none;
        }

        .key-bind {
            position: absolute;
            top: 2px;
            right: 4px;
            font-size: 12px;
            color: #fff;
            text-shadow: 1px 1px 0 #000;
        }

        .spell-icon {
            color: inherit;
        }

        .spell-btn.flash-heal .spell-icon {
            color: #f0e68c;
        }

        .spell-btn.greater-heal .spell-icon {
            color: #32cd32;
        }

        .spell-btn.renew .spell-icon {
            color: #98fb98;
        }

        .spell-btn.chain-heal .spell-icon {
            color: #f0c050;
        }

        .spell-btn.circle-of-healing .spell-icon {
            color: #87ceeb;
        }

        .mana-cost {
            position: absolute;
            bottom: 2px;
            right: 4px;
            font-size: 12px;
            color: #40C7EB;
            text-shadow: 1px 1px 0 #000;
        }

        /* Mana Bar */
        #player-mana {
            width: 300px;
            height: 20px;
            background: #222;
            border: 1px solid #444;
            margin: 0 auto;
            position: relative;
        }

        #mana-fill {
            height: 100%;
            background: var(--mana-color);
            width: 100%;
            transition: width 0.2s;
        }

        #mana-text {
            position: absolute;
            width: 100%;
            text-align: center;
            line-height: 18px;
            color: #fff;
            font-size: 11px;
            top: 0;
            text-shadow: 1px 1px 0 #000;
        }

        /* Floating Text */
        .floating-text {
            position: absolute;
            font-weight: bold;
            font-size: 20px;
            pointer-events: none;
            animation: floatUp 1s ease-out forwards;
            text-shadow: 1px 1px 0 #000;
            z-index: 100;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }

            100% {
                transform: translateY(-40px) scale(1.2);
                opacity: 0;
            }
        }

        .heal-text {
            color: var(--success-color);
        }

        .damage-text {
            color: var(--danger-color);
        }

        /* Toast */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 1000;
        }

        .toast {
            background: rgba(20, 20, 30, 0.9);
            color: #fff;
            padding: 10px 20px;
            border-left: 4px solid var(--primary-color);
            border-radius: 4px;
            animation: slideIn 0.3s ease-out;
            width: 300px;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }

            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Game Over / Victory Overlays */
        #overlay-message {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        #overlay-title {
            font-family: 'Cinzel', serif;
            font-size: 64px;
            margin-bottom: 20px;
        }

        .victory-text {
            color: var(--success-color);
        }

        .defeat-text {
            color: var(--danger-color);
        }

        #restart-btn {
            padding: 10px 30px;
            font-size: 20px;
            background: #444;
            color: #fff;
            border: 1px solid #666;
            cursor: pointer;
        }

        #restart-btn:hover {
            background: #555;
        }
    </style>
</head>

<body>

    <!-- Welcome Screen -->
    <div id="welcome-screen">
        <h1>Tiny Healer</h1>
        <p class="tagline">Raid Healing Simulator</p>
        <button id="start-button">Enter Raid</button>
    </div>

    <!-- Game Container -->
    <div id="game-container">

        <!-- Combat Area -->
        <div id="combat-area">
            <!-- Raid Frames -->
            <div id="raid-frames">
                <!-- Generated by JS -->
            </div>

            <!-- Boss Frame -->
            <div id="boss-frame">
                <div id="boss-name">Dreadlord</div>
                <div id="boss-hp-bar">
                    <div id="boss-hp-fill"></div>
                    <div id="boss-hp-text">100%</div>
                </div>
            </div>
        </div>

        <!-- Player Controls -->
        <div id="player-controls">
            <!-- Cast Bar -->
            <div id="cast-bar-container">
                <div id="cast-bar-fill"></div>
                <div id="cast-bar-text">Casting...</div>
            </div>

            <!-- Action Bar -->
            <div id="action-bar">
                <!-- Generated by JS -->
            </div>

            <!-- Mana Bar -->
            <div id="player-mana">
                <div id="mana-fill"></div>
                <div id="mana-text">100/100</div>
            </div>
        </div>

        <!-- Overlay -->
        <div id="overlay-message">
            <div id="overlay-title">VICTORY</div>
            <button id="restart-btn">Play Again</button>
        </div>

    </div>

    <!-- Toast Container -->
    <div id="toast-container"></div>

    <script>
        // --- Game Config & State ---
        const CONFIG = {
            gcd: 1000, // Global Cooldown in ms
            manaRegen: 2, // Mana per tick
            manaTickRate: 2000, // ms
        };

        const STATE = {
            allies: [],
            boss: { name: 'Dreadlord', hp: 10000, maxHp: 10000 },
            player: { mana: 100, maxMana: 100, casting: null, gcdEnd: 0 },
            selectedAllyIndex: null,
            gameActive: false,
            lastTick: 0
        };

        const SPELLS = [
            { id: 0, name: "Flash Heal", cost: 4, castTime: 0, heal: 60, icon: "fa-bolt", cssClass: "flash-heal" },
            { id: 1, name: "Greater Heal", cost: 6, castTime: 2000, heal: 150, icon: "fa-plus-square", cssClass: "greater-heal" },
            { id: 2, name: "Renew", cost: 5, castTime: 0, heal: 0, hot: { amount: 15, ticks: 5, interval: 2000 }, icon: "fa-leaf", cssClass: "renew" },
            { id: 3, name: "Chain Heal", cost: 12, castTime: 1500, heal: 80, targets: 3, icon: "fa-link", cssClass: "chain-heal" },
            { id: 4, name: "Circle of Healing", cost: 15, castTime: 0, heal: 50, targets: 5, cooldown: 10000, icon: "fa-circle-notch", cssClass: "circle-of-healing" }
        ];

        // --- Initialization ---
        function initGame() {
            // Create Allies
            STATE.allies = [
                { name: "Main Tank", class: "tank", hp: 1000, maxHp: 1000, buffs: [], debuffs: [] },
                { name: "Off Tank", class: "tank", hp: 1000, maxHp: 1000, buffs: [], debuffs: [] },
                { name: "Rogue 1", class: "rogue", hp: 400, maxHp: 400, buffs: [], debuffs: [] },
                { name: "Rogue 2", class: "rogue", hp: 400, maxHp: 400, buffs: [], debuffs: [] },
                { name: "Mage 1", class: "mage", hp: 350, maxHp: 350, buffs: [], debuffs: [] },
                { name: "Mage 2", class: "mage", hp: 350, maxHp: 350, buffs: [], debuffs: [] },
                { name: "Healer (You)", class: "healer", hp: 350, maxHp: 350, buffs: [], debuffs: [] },
                { name: "Warlock", class: "warlock", hp: 450, maxHp: 450, buffs: [], debuffs: [] },
            ];

            renderRaidFrames();
            renderActionBar();
            updateUI();

            STATE.gameActive = true;
            STATE.lastTick = performance.now();
            requestAnimationFrame(gameLoop);

            // Start Mana Regen
            setInterval(() => {
                if (!STATE.gameActive) return;
                STATE.player.mana = Math.min(STATE.player.maxMana, STATE.player.mana + CONFIG.manaRegen);
                updateManaBar();
            }, CONFIG.manaTickRate);
        }

        // --- Rendering ---
        function renderRaidFrames() {
            const container = document.getElementById('raid-frames');
            container.innerHTML = '';

            STATE.allies.forEach((ally, index) => {
                const frame = document.createElement('div');
                frame.className = 'unit-frame';
                frame.dataset.role = ally.class;
                frame.onclick = () => selectAlly(index);
                frame.id = `frame-${index}`;

                frame.innerHTML = `
                    <div class="health-fill"></div>
                    <div class="unit-info">
                        <span class="unit-name">${ally.name}</span>
                        <span class="unit-hp">100%</span>
                    </div>
                    <div class="auras" id="auras-${index}"></div>
                `;
                container.appendChild(frame);
            });
        }

        function renderActionBar() {
            const container = document.getElementById('action-bar');
            container.innerHTML = '';

            SPELLS.forEach((spell, index) => {
                const btn = document.createElement('div');
                btn.className = 'spell-btn';
                if (spell.cssClass) {
                    btn.classList.add(spell.cssClass);
                }
                btn.id = `spell-btn-${index}`;
                btn.onclick = () => castSpell(index);
                btn.innerHTML = `
                    <i class="fas ${spell.icon} spell-icon"></i>
                    <span class="key-bind">${index + 1}</span>
                    <span class="mana-cost">${spell.cost}</span>
                    <div class="spell-cd-overlay"></div>
                `;
                container.appendChild(btn);
            });
        }

        function updateUI() {
            STATE.allies.forEach((_, i) => updateUnitFrame(i));
            updateManaBar();
        }

        // --- Core Mechanics ---
        function selectAlly(index) {
            if (STATE.allies[index].hp <= 0) return;

            STATE.selectedAllyIndex = index;

            // Update Visuals
            document.querySelectorAll('.unit-frame').forEach(f => f.classList.remove('selected'));
            document.getElementById(`frame-${index}`).classList.add('selected');
        }

        function castSpell(spellIndex) {
            if (!STATE.gameActive) return;

            const spell = SPELLS[spellIndex];
            const now = Date.now();

            // Checks
            if (STATE.player.gcdEnd > now) return; // GCD
            if (STATE.player.mana < spell.cost) {
                showToast("Not enough mana!", "error");
                return;
            }
            if (STATE.player.casting) return; // Already casting
            if (STATE.selectedAllyIndex === null && !spell.targets) {
                showToast("No target selected!", "warning");
                return;
            }

            // Start Cast
            STATE.player.mana -= spell.cost;
            updateManaBar();

            // Trigger GCD
            triggerGCD();

            if (spell.castTime > 0) {
                startCastBar(spell);
            } else {
                finishCast(spell);
            }
        }

        function triggerGCD() {
            STATE.player.gcdEnd = Date.now() + CONFIG.gcd;
            // Visual GCD on buttons
            document.querySelectorAll('.spell-btn').forEach(btn => {
                btn.style.opacity = '0.5';
                setTimeout(() => btn.style.opacity = '1', CONFIG.gcd);
            });
        }

        function startCastBar(spell) {
            STATE.player.casting = {
                spell: spell,
                startTime: Date.now(),
                endTime: Date.now() + spell.castTime
            };

            const barContainer = document.getElementById('cast-bar-container');
            const barText = document.getElementById('cast-bar-text');

            barContainer.classList.add('casting');
            barText.textContent = `Casting ${spell.name}`;
        }

        function finishCast(spell) {
            STATE.player.casting = null;
            document.getElementById('cast-bar-container').classList.remove('casting');

            // Apply Effects
            if (spell.targets) {
                // Multi-target heal
                // Logic for smart targeting (lowest HP)
                const targets = [...STATE.allies]
                    .map((a, i) => ({ ...a, idx: i }))
                    .filter(a => a.hp > 0)
                    .sort((a, b) => (a.hp / a.maxHp) - (b.hp / b.maxHp))
                    .slice(0, spell.targets);

                targets.forEach(t => applyHeal(t.idx, spell.heal));
            } else {
                // Single target
                if (STATE.selectedAllyIndex !== null) {
                    applyHeal(STATE.selectedAllyIndex, spell.heal);
                    if (spell.hot) applyHoT(STATE.selectedAllyIndex, spell.hot);
                }
            }
        }

        function applyHeal(allyIndex, amount) {
            const ally = STATE.allies[allyIndex];
            if (ally.hp <= 0) return;

            const oldHp = ally.hp;
            ally.hp = Math.min(ally.maxHp, ally.hp + amount);
            const effectiveHeal = ally.hp - oldHp;

            showFloatingText(allyIndex, `+${effectiveHeal}`, 'heal-text');
            updateUnitFrame(allyIndex);
        }

        function applyHoT(allyIndex, hotData) {
            const ally = STATE.allies[allyIndex];
            // Simple HoT implementation: just push to buffs array
            // In a real engine we'd check for existing stacks
            ally.buffs.push({
                name: "Renew",
                remainingTicks: hotData.ticks,
                amount: hotData.amount,
                interval: hotData.interval,
                nextTick: Date.now() + hotData.interval,
                icon: "fa-leaf"
            });
            updateUnitFrame(allyIndex);
        }

        // --- Game Loop ---
        function gameLoop() {
            if (!STATE.gameActive) return;

            const now = Date.now();

            // 1. Handle Casting
            if (STATE.player.casting) {
                const cast = STATE.player.casting;
                if (now >= cast.endTime) {
                    finishCast(cast.spell);
                } else {
                    // Update Bar
                    const progress = (now - cast.startTime) / (cast.endTime - cast.startTime);
                    document.getElementById('cast-bar-fill').style.width = `${progress * 100}%`;
                }
            }

            // 2. Handle Buffs/HoTs
            STATE.allies.forEach((ally, idx) => {
                if (ally.hp <= 0) return;

                for (let i = ally.buffs.length - 1; i >= 0; i--) {
                    const buff = ally.buffs[i];
                    if (now >= buff.nextTick) {
                        applyHeal(idx, buff.amount);
                        buff.remainingTicks--;
                        buff.nextTick += buff.interval;
                        if (buff.remainingTicks <= 0) {
                            ally.buffs.splice(i, 1);
                            updateUnitFrame(idx);
                        }
                    }
                }
            });

            // 3. Boss Logic (Simple for now)
            if (Math.random() < 0.02) { // Random damage tick
                const targetIdx = Math.floor(Math.random() * STATE.allies.length);
                dealDamage(targetIdx, 50 + Math.floor(Math.random() * 50));
            }

            requestAnimationFrame(gameLoop);
        }

        function dealDamage(allyIndex, amount) {
            const ally = STATE.allies[allyIndex];
            if (ally.hp <= 0) return;

            ally.hp = Math.max(0, ally.hp - amount);
            showFloatingText(allyIndex, `-${amount}`, 'damage-text');
            updateUnitFrame(allyIndex);

            if (ally.hp <= 0) {
                // Ally died
                checkGameOver();
            }
        }

        // --- UI Updates ---
        function updateUnitFrame(index) {
            const ally = STATE.allies[index];
            const frame = document.getElementById(`frame-${index}`);
            const fill = frame.querySelector('.health-fill');
            const hpText = frame.querySelector('.unit-hp');
            const auras = document.getElementById(`auras-${index}`);

            const pct = (ally.hp / ally.maxHp) * 100;
            fill.style.width = `${pct}%`;
            hpText.textContent = `${Math.floor(ally.hp)}`;

            if (ally.hp <= 0) frame.classList.add('dead');

            // Update Auras
            auras.innerHTML = '';
            ally.buffs.forEach(buff => {
                const icon = document.createElement('div');
                icon.className = 'aura hot';
                icon.innerHTML = `<i class="fas ${buff.icon}"></i>`;
                auras.appendChild(icon);
            });
        }

        function updateManaBar() {
            const pct = (STATE.player.mana / STATE.player.maxMana) * 100;
            document.getElementById('mana-fill').style.width = `${pct}%`;
            document.getElementById('mana-text').textContent = `${Math.floor(STATE.player.mana)}/${STATE.player.maxMana}`;
        }

        function showFloatingText(allyIndex, text, className) {
            const frame = document.getElementById(`frame-${allyIndex}`);
            if (!frame) return;

            const rect = frame.getBoundingClientRect();
            const el = document.createElement('div');
            el.className = `floating-text ${className}`;
            el.textContent = text;
            el.style.left = `${rect.left + rect.width / 2}px`;
            el.style.top = `${rect.top}px`;

            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1000);
        }

        function showToast(msg, type) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.borderLeftColor = type === 'error' ? 'red' : type === 'warning' ? 'orange' : 'green';
            toast.textContent = msg;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function checkGameOver() {
            if (STATE.allies.every(a => a.hp <= 0)) {
                STATE.gameActive = false;
                document.getElementById('overlay-message').style.display = 'flex';
                document.getElementById('overlay-title').textContent = "DEFEAT";
                document.getElementById('overlay-title').className = "defeat-text";
            }
        }

        // --- Event Listeners ---
        document.getElementById('start-button').addEventListener('click', () => {
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'grid';
            initGame();
        });

        document.getElementById('restart-btn').addEventListener('click', () => {
            document.getElementById('overlay-message').style.display = 'none';
            initGame();
        });

        // Keyboard Support
        document.addEventListener('keydown', (e) => {
            if (e.key >= '1' && e.key <= '5') {
                castSpell(parseInt(e.key) - 1);
            }
        });

    </script>
</body>

</html>